<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- タイトル -->
  <text x="60" y="60" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#1976d2">システムアーキテクチャ</text>
  
  <!-- ユーザー -->
  <circle cx="120" cy="200" r="40" fill="#9e9e9e" stroke="#666" stroke-width="2"/>
  <text x="120" y="208" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="white">ユーザー</text>
  
  <!-- Flutter App -->
  <rect x="220" y="160" width="140" height="80" rx="10" fill="#42a5f5" stroke="#1976d2" stroke-width="2"/>
  <text x="290" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Flutter App</text>
  <text x="290" y="205" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">音声録音・UI</text>
  
  <!-- Firebase Authentication -->
  <rect x="420" y="160" width="140" height="80" rx="10" fill="#ff9800" stroke="#f57c00" stroke-width="2"/>
  <text x="490" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Firebase</text>
  <text x="490" y="205" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">Authentication</text>
  
  <!-- FastAPI -->
  <rect x="620" y="160" width="140" height="80" rx="10" fill="#1976d2" stroke="#0d47a1" stroke-width="2"/>
  <text x="690" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">FastAPI</text>
  <text x="690" y="205" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">Cloud Run</text>
  
  <!-- Vertex AI -->
  <rect x="820" y="160" width="140" height="80" rx="10" fill="#4caf50" stroke="#388e3c" stroke-width="2"/>
  <text x="890" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Vertex AI</text>
  <text x="890" y="205" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">感情分析</text>
  
  <!-- Cloud Firestore -->
  <rect x="1020" y="160" width="140" height="80" rx="10" fill="#ff5722" stroke="#d84315" stroke-width="2"/>
  <text x="1090" y="185" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Cloud</text>
  <text x="1090" y="205" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">Firestore</text>
  
  <!-- 矢印と接続線 -->
  <!-- ユーザー → Flutter App -->
  <path d="M 160 200 L 200 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="180" y="195" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">音声入力</text>
  
  <!-- Flutter App → Firebase -->
  <path d="M 360 200 L 400 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="380" y="195" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">1) 認証</text>
  
  <!-- Firebase → FastAPI -->
  <path d="M 560 200 L 600 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="580" y="195" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">2) トークン</text>
  
  <!-- FastAPI → Vertex AI -->
  <path d="M 760 200 L 800 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="780" y="195" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">3) API推論</text>
  
  <!-- Vertex AI → Cloud Firestore -->
  <path d="M 960 200 L 1000 200" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <text x="980" y="195" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">4) 保存</text>
  
  <!-- データフローセクション -->
  <text x="60" y="540" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1976d2">データフロー</text>
  
  <!-- データフロー項目 -->
  <g>
    <!-- 1 -->
    <circle cx="90" cy="580" r="15" fill="#2196f3"/>
    <text x="90" y="587" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">1</text>
    <text x="120" y="587" font-family="Arial, sans-serif" font-size="16" fill="#333">ユーザーがFlutterアプリで音声を録音</text>
    
    <!-- 2 -->
    <circle cx="90" cy="620" r="15" fill="#ff9800"/>
    <text x="90" y="627" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">2</text>
    <text x="120" y="627" font-family="Arial, sans-serif" font-size="16" fill="#333">Firebase Authenticationで認証・IDトークン取得</text>
    
    <!-- 3 -->
    <circle cx="90" cy="660" r="15" fill="#1976d2"/>
    <text x="90" y="667" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">3</text>
    <text x="120" y="667" font-family="Arial, sans-serif" font-size="16" fill="#333">FastAPI (Cloud Run) で音声処理・認証チェック</text>
    
    <!-- 4 -->
    <circle cx="90" cy="700" r="15" fill="#4caf50"/>
    <text x="90" y="707" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">4</text>
    <text x="120" y="707" font-family="Arial, sans-serif" font-size="16" fill="#333">Vertex AIで感情分析 → (x, y, color) 座標生成</text>
    
    <!-- 5 -->
    <circle cx="90" cy="740" r="15" fill="#ff5722"/>
    <text x="90" y="747" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">5</text>
    <text x="120" y="747" font-family="Arial, sans-serif" font-size="16" fill="#333">Cloud Firestoreに日記データ・感情データを保存</text>
  </g>
  
  <!-- 矢印のマーカー定義 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
</svg>